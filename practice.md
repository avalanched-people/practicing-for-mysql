# 1. 如何将正常的表格转为交叉表
数据样本：
```mysql
create table tx(
 id int primary key,
 c1 char(2),
 c2 char(2),
 c3 int
);
```
 
```mysql
insert into tx values
(1 ,'A1','B1',9),
(2 ,'A2','B1',7),
(3 ,'A3','B1',4),
(4 ,'A4','B1',2),
(5 ,'A1','B2',2),
(6 ,'A2','B2',9),
(7 ,'A3','B2',8),
(8 ,'A4','B2',5),
(9 ,'A1','B3',1),
(10 ,'A2','B3',8),
(11 ,'A3','B3',8),
(12 ,'A4','B3',6),
(13 ,'A1','B4',8),
(14 ,'A2','B4',2),
(15 ,'A3','B4',6),
(16 ,'A4','B4',9),
(17 ,'A1','B4',3),
(18 ,'A2','B4',5),
(19 ,'A3','B4',2),
(20 ,'A4','B4',5);
```
 
```mysql
select * from tx;
```
+----+------+------+------+  
| id | c1   | c2   | c3   |  
+----+------+------+------+  
|  1 | A1   | B1   |    9 |  
|  2 | A2   | B1   |    7 |  
|  3 | A3   | B1   |    4 |  
|  4 | A4   | B1   |    2 |  
|  5 | A1   | B2   |    2 |  
|  6 | A2   | B2   |    9 |  
|  7 | A3   | B2   |    8 |  
|  8 | A4   | B2   |    5 |  
|  9 | A1   | B3   |    1 |  
| 10 | A2   | B3   |    8 |  
| 11 | A3   | B3   |    8 |  
| 12 | A4   | B3   |    6 |  
| 13 | A1   | B4   |    8 |  
| 14 | A2   | B4   |    2 |  
| 15 | A3   | B4   |    6 |  
| 16 | A4   | B4   |    9 |  
| 17 | A1   | B4   |    3 |  
| 18 | A2   | B4   |    5 |  
| 19 | A3   | B4   |    2 |  
| 20 | A4   | B4   |    5 |  
+----+------+------+------+  
20 rows in set (0.00 sec)  
需要的结果:  
+------+-----+-----+-----+-----+------+    
|C1    |B1   |B2   |B3   |B4   |Total |    
+------+-----+-----+-----+-----+------+  
|A1    |9    |2    |1    |11   |23    |  
|A2    |7    |9    |8    |7    |31    |  
|A3    |4    |8    |8    |8    |28    |  
|A4    |2    |5    |6    |14   |27    |  
|Total |22   |24   |23   |40   |109   |  
+------+-----+-----+-----+-----+------+  


step1 对每一个 c1, c2分组进行统计  
```mysql
select c1, ifnull(c2, 'total'), sum(c3) 
from tx
group by c1, c2
with rollup
having c1 is not null
```
得到结果如下:  
+----+---------------------+---------+  
| c1 | ifnull(c2, 'total') | sum(c3) |  
+----+---------------------+---------+  
| A1 | B1                  | 9       |  
| A1 | B2                  | 2       |  
| A1 | B3                  | 1       |  
| A1 | B4                  | 11      |  
| A1 | total               | 23      |  
| A2 | B1                  | 7       |  
| A2 | B2                  | 9       |  
| A2 | B3                  | 8       |  
| A2 | B4                  | 7       |  
| A2 | total               | 31      |  
| A3 | B1                  | 4       |  
| A3 | B2                  | 8       |  
| A3 | B3                  | 8       |  
| A3 | B4                  | 8       |  
| A3 | total               | 28      |  
| A4 | B1                  | 2       |  
| A4 | B2                  | 5       |  
| A4 | B3                  | 6       |  
| A4 | B4                  | 14      |  
| A4 | total               | 27      |  
+----+---------------------+---------+  
20 rows in set  
接下来进行进一步的加总，主要是sum(if())的使用!  
```mysql
select 
ifnull(c1, 'total') c1, 
sum(if(c2 = 'B1', c3, 0)) B1, 
sum(if(c2 = 'B2', c3, 0)) B2, 
sum(if(c2 = 'B3', c3, 0)) B3, 
sum(if(c2 = 'B4', c3, 0)) B4, 
sum(if(c2 = 'total', c3, 0)) total 
from 
(select c1, ifnull(c2, 'total') c2, sum(c3) c3 
from tx
group by c1, c2
with rollup
having c1 is not null) p 
group by c1 with rollup;
```
